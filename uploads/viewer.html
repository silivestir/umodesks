
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<!-- <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"> -->
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script src="/js/pdf.min.js"></script>
<script src="/js/pdf.worker.min.js"></script>

    <link rel="stylesheet" href="/js/bootstrap.min.js">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
     <script src="/js/pdf.min.js"></script> 
    <!-- Link to your custom CSS file -->
    <link rel="stylesheet" href="/css/styles.css">
    <style>
      
    .a{
     
      background-image:url('mobcashfooter.jpg');
       }
      .b{
        font-weight: bold;
        text-decoration: none;
        color:white;
      }
    </style>
<style type="text/css">
#show-pdf-button {
	width: 150px;
	display: block;
	margin: 20px auto;
}

#file-to-upload {
	display: none;
}

#pdf-main-container {
	width: 380px;
	margin: 0px;
}

#pdf-loader {
	display: none;
	text-align: center;
	color: #999999;
	font-size: 13px;
	line-height: 100px;
	height: 100px;
}

#pdf-contents {
	display: none;
}

#pdf-meta {
	overflow: hidden;
	margin: 0 0 20px 0;
}

#pdf-buttons {
	float: left;
}

#page-count-container {
	float: right;
}

#pdf-current-page {
	display: inline;
}

#pdf-total-pages {
	display: inline;
}

#pdf-canvas {
	border: 1px solid rgba(0,0,0,0.2);
	box-sizing: border-box;
	width: 380px;
}

#page-loader {
	height: 100px;
	line-height: 100px;
	text-align: center;
	display: none;
	color: #999999;
	font-size: 13px;
}
</style>
</head>

<body>
<nav class="navbar navbar-expand-lg a">
  <h1 class=" b">UMODesk</h1>
  <div class="container b">
    <span class="b">MENU</span>
  <p style="color:white">
    <button class="navbar-toggler  b" style="border 11px solid white" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav"
    aria-expanded="false" aria-label="Toggle navigation">
      <p style="background-color:white">
    <span class="navbar-toggler-icon b"></span></p>
    </button></p>
    <div class="collapse navbar-collapse b" 
    id="navbarNav">
      <ul class="navbar-nav me-auto ">
        <li class="nav-item">
         <a class="nav-link " href="/login"><span class="b">Login</span></a>
         <a class="nav-link a" href="/signup"><span class="b">Signup</span></a>
        </li>
      </ul>
      
      <ul class="navbar-nav me-auto">
        <li class="nav-item">
         <span class="a"></span> <a class="nav-link a" href="/in"><span class="b">Home</span></a></span>
        </li>
        <li class="nav-item">
          <a class="nav-link a" href="/mybooks"><span class="b">Notifications</span><span style='color:white;font-weight:bold'>(0)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link a" href="/salio"><span class="b">Salio</span></a>
        </li>
        
         <li class="nav-item">
          <a class="nav-link a" href="/upload"><span class="b">upload</span></a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div id="file-list-container">
    <ul id="file-list">
      <!-- Dynamically created file list will be inserted here -->
    </ul>
  </div>

<!--<button id="show-pdf-button">Show PDF</button> -->
<div id="pdf-main-container">
	<div id="pdf-loader">UMODesk is Loading the book ...</div>
	<div id="pdf-contents">
		<div id="pdf-meta">
			<div id="pdf-buttons">
				<button id="pdf-prev">Previous</button>
				<button id="pdf-next">Next</button>
			</div>
			<div id="page-count-container">Page <div id="pdf-current-page"></div> of <div id="pdf-total-pages"></div></div>
		</div>
		<!-- <canvas id="pdf-canvas" width="400"></canvas> -->
		<canvas id="pdf-canvas" width="2000"></canvas>
		<div id="page-loader">Loading page ...</div>
	</div>
</div>

<script>
// Function to fetch files from the database
async function fetchFilesFromDB() {
    try {
        const response = await fetch('/books'); // Use the '/books' route to fetch files from the database
        const files = await response.json();
        return files;
    } catch (error) {
        console.error('Error fetching files:', error);
        return [];
    }
}
// Function to render the selected PDF file
function renderPDF(path) {
    const filename = path.split('/').pop(); // Extract filename from path
    showPDF(filename); // Render the selected file when clicked
}

// Function to dynamically create file list from fetched data
async function createFileListFromDB() {
    const fileListContainer = document.getElementById('file-list');
    const files = await fetchFilesFromDB();
    files.forEach(file => {
        const listItem = document.createElement('li');
        listItem.textContent = file.title;
        listItem.addEventListener('click', function() {
          
          
          const filename = file.path.split('/').pop(); // Extract filename from path
   // showPDF(filename); //
          const filenameAsString = filename.toString(); // Convert filename to stringalert
          //alert(filename)
          
          let a='WEB DESIGNING.pdf'
renderPDF(filename);
         // const a='UDAHILI DANGOTE.pdf'
          //  renderPDF(a); // Render the selected file when clicked
        });
        fileListContainer.appendChild(listItem);
    });
}

// Call the function to create the file list from the database
createFileListFromDB();

var _PDF_DOC,
    _CURRENT_PAGE,
    _TOTAL_PAGES,
    _PAGE_RENDERING_IN_PROGRESS = 0,
    _CANVAS = document.querySelector('#pdf-canvas');

// initialize and load the PDF
async function showPDF(pdf_url) {
    document.querySelector("#pdf-loader").style.display = 'block';

    // get handle of pdf document
    try {
     // alert(pdf_url)
      
        _PDF_DOC = await pdfjsLib.getDocument({ url: pdf_url });
    }
    catch(error) {
        alert(error.message);
    }

    // total pages in pdf
    _TOTAL_PAGES = _PDF_DOC.numPages;
    
    // Hide the pdf loader and show pdf container
    document.querySelector("#pdf-loader").style.display = 'none';
    document.querySelector("#pdf-contents").style.display = 'block';
    document.querySelector("#pdf-total-pages").innerHTML = _TOTAL_PAGES;

    // show the first page
    showPage(1);
}

// load and render specific page of the PDF
async function showPage(page_no) {
    _PAGE_RENDERING_IN_PROGRESS = 1;
    _CURRENT_PAGE = page_no;

    // disable Previous & Next buttons while page is being loaded
    document.querySelector("#pdf-next").disabled = true;
    document.querySelector("#pdf-prev").disabled = true;

    // while page is being rendered hide the canvas and show a loading message
    document.querySelector("#pdf-canvas").style.display = 'none';
    document.querySelector("#page-loader").style.display = 'block';

    // update current page
    document.querySelector("#pdf-current-page").innerHTML = page_no;
    
    // get handle of page
    try {
        var page = await _PDF_DOC.getPage(page_no);
    }
    catch(error) {
        alert(error.message);
    }

    // original width of the pdf page at scale 1
    var pdf_original_width = page.getViewport(1).width;
    
    // as the canvas is of a fixed width we need to adjust the scale of the viewport where page is rendered
    var scale_required = _CANVAS.width / pdf_original_width;

    // get viewport to render the page at required scale
    var viewport = page.getViewport(scale_required);

    // set canvas height same as viewport height
    _CANVAS.height = viewport.height;

    // setting page loader height for smooth experience
    document.querySelector("#page-loader").style.height =  _CANVAS.height + 'px';
    document.querySelector("#page-loader").style.lineHeight = _CANVAS.height + 'px';

    // page is rendered on <canvas> element
    var render_context = {
        canvasContext: _CANVAS.getContext('2d'),
        viewport: viewport
    };
        
    // render the page contents in the canvas
    try {
        await page.render(render_context);
    }
    catch(error) {
        alert(error.message);
    }

    _PAGE_RENDERING_IN_PROGRESS = 0;

    // re-enable Previous & Next buttons
    document.querySelector("#pdf-next").disabled = false;
    document.querySelector("#pdf-prev").disabled = false;

    // show the canvas and hide the page loader
    document.querySelector("#pdf-canvas").style.display = 'block';
    document.querySelector("#page-loader").style.display = 'none';
}

// click on the "Previous" page button
document.querySelector("#pdf-prev").addEventListener('click', function() {
    if(_CURRENT_PAGE != 1)
        showPage(--_CURRENT_PAGE);
});

// click on the "Next" page button
document.querySelector("#pdf-next").addEventListener('click', function() {
    if(_CURRENT_PAGE != _TOTAL_PAGES)
        showPage(++_CURRENT_PAGE);
});
</script>

</body>
 <script src="/js/script.js"></script>
        <script src="/js/pdf.min.js"></script>

    <script src="/js/bootstrap.min.js"></script>

<script src="../bootstrap/dist/js/bootstrap.min.js"></script>
</html>
